<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>01 Understanding Kubernetes | Senalyst </title> <meta name="author" content="Senalyst "> <meta name="description" content="Most content in this document comes from " learn kubernetes in a month of lunches> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://seyoungnam.github.io/_k8s/01-understanding-k8s/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "01 Understanding Kubernetes",
      "description": "Most content in this document comes from "Learn Kubernetes in a Month of Lunches".",
      "published": "January 6, 2022",
      "authors": [
        {
          "author": "Elton Stoneman",
          "authorURL": "https://www.linkedin.com/in/eltonstoneman/?originalSubdomain=uk",
          "affiliations": [
            {
              "name": "Sixeyed Consulting",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Senalyst </span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">technology</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/go/">Golang</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/k8s/">Kubernetes</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/istio/">Istio</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/network/">Network</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">algorithms</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/leetcode/">LeetCode</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/algoexpert/">AlgoExpert</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>01 Understanding Kubernetes</h1> <p>Most content in this document comes from "Learn Kubernetes in a Month of Lunches".</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#1-two-core-concepts">1. Two core concepts</a></div> <div><a href="#2-containers-vs-pods-vs-nodes">2. Containers vs Pods vs Nodes</a></div> <div><a href="#3-running-pods-with-controllers">3. Running Pods with controllers</a></div> <div><a href="#4-defining-deployments-in-application-manifests">4. Defining Deployments in application manifests</a></div> <div><a href="#5-working-with-applications-in-pods">5. Working with applications in Pods</a></div> <div><a href="#6-understanding-kubernetes-resource-management">6. Understanding Kubernetes resource management</a></div> </nav> </d-contents> <h2 id="1-two-core-concepts">1. Two core concepts</h2> <p>Kubernetes is a platform for running containers. The two core concepts in Kubernetes are …</p> <ul> <li> <strong>API</strong> where to define your applications</li> <li> <strong>cluster</strong>, where to run your applications. A cluster is a single logical unit composed of many server nodes</li> </ul> <p>A cluster is a single logical unit composed of many individual servers, called <strong>nodes</strong> in Kubernetes. Some nodes run the Kubernetes API, whereas others run application workloads, all in containers.</p> <p>The way to interact with the Kubernetes cluster is through YAML files. You write your app specs in YAML files and send them to the Kubernetes API. Kubernetes compare them to the current app state/spec running in the cluster, and makes any changes to get to the desired state.</p> <p>Important concepts in Kubernetes.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">application manifests</code> : YAML files</li> <li> <code class="language-plaintext highlighter-rouge">Resources</code> : components that go into shipping the app <ul> <li> <code class="language-plaintext highlighter-rouge">Services</code> : Kubernetes objects for managing network access</li> <li> <code class="language-plaintext highlighter-rouge">Pods</code> : a unit of compute that runs one or more containers, has its own virtual IP address</li> <li> <code class="language-plaintext highlighter-rouge">Deployments</code> : manage pods</li> <li><code class="language-plaintext highlighter-rouge">ReplicaSets</code></li> <li><code class="language-plaintext highlighter-rouge">ConfigMaps</code></li> <li><code class="language-plaintext highlighter-rouge">Secrets</code></li> </ul> </li> </ul> <h2 id="2-containers-vs-pods-vs-nodes">2. Containers vs Pods vs Nodes</h2> <ul> <li>Containers are packages of applications and execution environments.</li> <li>Pods are collections of closely-related or tightly coupled containers.</li> <li>Nodes are computing resources that house pods to execute workloads. Their responsiblity is to manage the pods and its containers by working with container runtime using a known API called the Container Runtime Interface(CRI). (source: <a href="https://www.containiq.com/post/kubernetes-nodes-vs-pods-vs-containers" target="_blank" rel="external nofollow noopener">Kubernetes: Nodes vs. Pods vs. Containers </a>)</li> </ul> <p>Kubernetes does not run containers. Pods are allocated to one node, and it’s that node’s responsibility to manage the Pod and its containers. It does that by working with the container runtime using a known API called the Container Runtime Interface(CRI).</p> <h2 id="3-running-pods-with-controllers">3. Running Pods with controllers</h2> <p>If a node goes offline, the Pod is lost, and Kubernetes does not replace it. In this case, the <code class="language-plaintext highlighter-rouge">Deployment</code>, one of many <code class="language-plaintext highlighter-rouge">controllers</code> in Kubernetes, works with the Kubernetes API to watch the current state of the system, compares that to the desired state of its resources, and makes any changes necessary.</p> <p>You can create Deployment resources with kubectl, specifying the container image you want to run and any other configuration for the Pod. Kubernetes creates the Deployment, and the Deployment creates the Pod.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># create a Deployment called "hello-kiamol-2", running the same web app:
kubectl create deployment hello-kiamol-2 --image=kiamol/ch02-hello-kiamol

# list all the Pods:
kubectl get pods
</code></pre></div></div> <p>The Deployment specification described the Pod you wanted, and the Deployment created that Pod by interacting with the Kubernetes API.</p> <p>The Deployment adds labels to Pods it manages. In other words, a Deployment and related Pods share the same key-value label(e.g. app=x).</p> <h2 id="4-defining-deployments-in-application-manifests">4. Defining Deployments in application manifests</h2> <p>Below YAML script is the simplest app manifest you can write.</p> <p><strong>pod.yaml</strong></p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Manifests always specify the version of the Kubernetes API</span>
<span class="c"># and the type of resource.</span>
apiVersion: v1
kind: Pod

<span class="c"># Metadata for the resource includes the name (mandatory) </span>
<span class="c"># and labels (optional).</span>
metadata:
  name: hello-kiamol-3

<span class="c"># The spec is the actual specification for the resource.</span>
<span class="c"># For a Pod the minimum is the container(s) to run, </span>
<span class="c"># with the container name and image.</span>
spec:
  containers:
    - name: web
      image: kiamol/ch02-hello-kiamol</code></pre></figure> <p>Kubectl doesn’t even need a local copy of a manifest file. It can read the contents from any public URL. Deploy the same Pod definition direct from the file on GitHub.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># deploy the application from the manifest file:</span>
kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/sixeyed/kiamol/master/ch02/pod.yaml</code></pre></figure> <p>The Deployment definition is a composite that includes the Pod spec.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Deployments are part of the apps version 1 API spec.</span>
apiVersion: apps/v1
kind: Deployment
<span class="c"># The Deployment needs a name.</span>
metadata:
  name: hello-kiamol-4
<span class="c"># The spec includes the label selector the Deployment uses </span>
<span class="c"># to find its own managed resources--I’m using the app label,</span>
<span class="c"># but this could be any combination of key-value pairs.</span>
spec:
  selector:
    matchLabels:
      app: hello-kiamol-4
<span class="c"># The template is used when the Deployment creates a Pod template.</span>
<span class="c"># Pods in a Deployment don’t have a name, </span>
<span class="c"># but they need to specify labels that match the selector</span>
<span class="c"># metadata.</span>
  template:
    metadata:
      labels:
        app: hello-kiamol-4
<span class="c"># The Pod spec lists the container name and image spec.</span>
    spec:
      containers:
        - name: web
          image: kiamol/ch02-hello-kiamol</code></pre></figure> <h2 id="5-working-with-applications-in-pods">5. Working with applications in Pods</h2> <p>You can run commands inside containers with kubectl and connect a terminal session, so you can connect into a Pod’s container as though you were connecting to a remote machine.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># check the internal IP address of the first Pod we ran: </span>
kubectl get pod hello-kiamol <span class="nt">-o</span> custom-columns<span class="o">=</span>NAME:metadata.name,POD_IP:status.podIP

<span class="c"># run an interactive shell command in the Pod:</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> hello-kiamol <span class="nt">--</span> sh

<span class="c"># inside the Pod, check the IP address:</span>
<span class="nb">hostname</span> <span class="nt">-i</span>

<span class="c"># and test the web app:</span>
wget <span class="nt">-O</span> - http://localhost | <span class="nb">head</span> <span class="nt">-n</span> 4

<span class="c"># leave the shell:</span>
<span class="nb">exit</span></code></pre></figure> <p>For troubleshooting, the simple option is to read the application logs by accessing to the container runtime with <code class="language-plaintext highlighter-rouge">kubectl logs</code>.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># print the latest container logs from Kubernetes:</span>
kubectl logs <span class="nt">--tail</span><span class="o">=</span>2 hello-kiamol

<span class="c"># and compare the actual container logs--if you’re using Docker:</span>
docker container logs <span class="nt">--tail</span><span class="o">=</span>2 <span class="si">$(</span>docker container <span class="nb">ls</span> <span class="nt">-q</span> <span class="nt">--filter</span> <span class="nv">label</span><span class="o">=</span>io.kubernetes.container.name<span class="o">=</span>hello-kiamol<span class="si">)</span></code></pre></figure> <p>You can run commands in Pods that are managed by a Deployment without knowing the Pod name, and you can view the logs of all Pods that match a label selector.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># make a call to the web app inside the container for the </span>
<span class="c"># Pod we created from the Deployment YAML file: </span>
kubectl <span class="nb">exec </span>deploy/hello-kiamol-4 <span class="nt">--</span> sh <span class="nt">-c</span> <span class="s1">'wget -O - http://localhost &gt; /dev/null'</span>

<span class="c"># and check that Pod’s logs:</span>
kubectl logs <span class="nt">--tail</span><span class="o">=</span>1 <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>hello-kiamol-4</code></pre></figure> <p>Kubectl lets you copy files between your local machine and containers in Pods. Create a temporary directory on your machine, and copy a file into it from the Pod container.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># create the local directory:</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /tmp/kiamol/ch02

<span class="c"># copy the web page from the Pod:</span>
kubectl <span class="nb">cp </span>hello-kiamol:usr/share/nginx/html/index.html /tmp/kiamol/ch02/index.html

<span class="c"># check the local file contents:</span>
<span class="nb">cat</span> /tmp/kiamol/ch02/index.html</code></pre></figure> <h2 id="6-understanding-kubernetes-resource-management">6. Understanding Kubernetes resource management</h2> <p>If you try to delete all Pods by using <code class="language-plaintext highlighter-rouge">kubectl delete pods --all</code>, you can see that Pods created by Deployment controllers are deleted and replaced with new ones.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># list all running Pods:</span>
kubectl get pods

<span class="c"># delete all Pods:</span>
kubectl delete pods <span class="nt">--all</span>

<span class="c"># check again:</span>
kubectl get pods</code></pre></figure> <p>If you want to delete a resource that is managed by a controller, you need to delete the controller instead. Controllers clean up their resources when they are deleted, so removing a Deployment is like a cascading delete that removes all the Deployment’s Pods, too.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># view Deployments:</span>
kubectl get deploy

<span class="c"># delete all Deployments:</span>
kubectl delete deploy <span class="nt">--all</span>

<span class="c"># view Pods:</span>
kubectl get pods

<span class="c"># check all resources:</span>
kubectl get all</code></pre></figure> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"alshedivat/al-folio","data-repo-id":"MDEwOlJlcG9zaXRvcnk2MDAyNDM2NQ==","data-category":"Comments","data-category-id":"DIC_kwDOA5PmLc4CTBt6","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,a])=>giscusScript.setAttribute(t,a)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Senalyst . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>