<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Concepts - Security | Senalyst </title> <meta name="author" content="Senalyst "> <meta name="description" content="A personal blog for software engineering and life in Seattle. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://seyoungnam.github.io/istio/02-security/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Senalyst </span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">technology</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/go/">Golang</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/k8s/">Kubernetes</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/istio/">Istio</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/network/">Network</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">algorithms</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/leetcode/">LeetCode</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/algoexpert/">AlgoExpert</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Concepts - Security</h1> <p class="post-meta">February 4, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a> </p> </header> <article class="post-content"> <p>모놀리식(monolithic) 어플리케이션을 여러개의 서비스로 분해하면 더 나은 민첩성과 확장성, 그리고 서비스 재사용성 등 다양한 이점을 얻을 수 있습니다. 그러나 마이크로서비스는 다음과 같은 특별한 보안 요구사항이 발생합니다:</p> <ul> <li>중간자 공격(man-in-the-middle attacks)을 방어하기 위해 트래픽 암호화가 필요</li> <li>유연한 서비스 접근 제어를 위해 상호 TLS와 세분화된 접근 정책 설정이 필요</li> <li>누가 언제 무엇을 했는지 확인을 위해 감사 도구가 필요</li> </ul> <p>Istio는 이러한 문제를 해결하기 위한 포괄적인 보안 솔루션을 제공합니다. 이 페이지에서는 Istio 보안 기능을 사용하여 어디서든 서비스를 보호할 수 있는 방법에 대해 간략하게 살펴 볼 예정입니다. 특히 Istio 보안 기능을 통해 데이터, 엔드포인트, 통신 및 플랫폼에 대한 내외부 위협을 모두 완화할 수 있습니다.</p> <p><img src="https://istio.io/latest/docs/concepts/security/overview.svg" alt="Security overview"></p> <p>Istio 보안 기능은 강한 신분 확인, 강력한 정책, 투명한 TLS 암호화, 인증, 승인 및 감사(authentication, authorization and audit, AAA) 도구를 제공하여 서비스와 데이터를 보호합니다. Istio의 보안 목표는 다음과 같습니다:</p> <ul> <li>기본값으로서의 보안: 어플리케이션 코드 및 인프라 변경 불필요</li> <li>심층 방어: 기존 보안 시스템과 통합하여 여러 계층의 방어 시스템 제공</li> <li>제로 트러스트 네트워크: 신뢰할 수 없는 네트워크에 보안 솔루션을 구축</li> </ul> <p>배포된 서비스에서 Istio 보안 기능을 사용하려면 <a href="https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/" rel="external nofollow noopener" target="_blank">상호 TLS 마이그레이션 문서</a>를 참고하십시오. 보안 기능 사용에 대한 자세한 지침을 보려면 <a href="https://istio.io/latest/docs/tasks/security/" rel="external nofollow noopener" target="_blank">보안 작업</a>을 참고하십시오.</p> <p><br></p> <h2 id="아키텍처-훑어보기">아키텍처 훑어보기</h2> <p>Istio 내 보안은 다수의 구성요소를 지니고 있습니다:</p> <ul> <li>키 및 인증서 관리를 위한 인증 기관(Certificate Authority, CA)</li> <li>설정 API 서버가 프록시에 배포하는 요소들: <ul> <li>인증 정책</li> <li>승인 정책</li> <li>보안 명명 정보</li> </ul> </li> <li>사이드카 및 바깥 프록시는 정책 적용 지점(Policy Enforcement Points, PEP)로 작동하여 클라이언트와 서버 간의 통신을 보호</li> <li>원격 측정(telemetry) 및 감사 관리를 위한 Envoy 프록시 확장 세트</li> </ul> <p>제어 영역(Control plane)은 API 서버의 설정을 처리하고 데이터 영역(data plane)내 PEP(정책 적용 지점)를 설정합니다. PEP는 Envoy를 사용하여 구현됩니다. 다음 다이어그램은 관련 아키텍쳐를 보여줍니다.</p> <p><img src="https://istio.io/latest/docs/concepts/security/arch-sec.svg" alt="Security Architecture"></p> <p>앞으로 이어질 섹션에서는 Istio의 보안 기능에 대해 더 자세하게 다룰 예정입니다.</p> <p><br></p> <h2 id="istio-신원-정보">Istio 신원 정보</h2> <p>신원 정보는 모든 보안 인프라에 적용되는 기본 개념입니다. 워크로드 간 통신이 시작될 때 두 당사자는 상호 인증을 위해 신분 정보가 포함하고 있는 자격 정보를 교환해야 합니다. 클라이언트 측에서는 서버의 신분을 <a href="https://istio.io/latest/docs/concepts/security/#secure-naming" rel="external nofollow noopener" target="_blank">보안 이름(secure naming)</a> 정보와 비교하여 워크로드 실행자가 기승인 되었는지 확인 합니다. 서버 측에서는 입력된 <a href="https://istio.io/latest/docs/concepts/security/#authorization-policies" rel="external nofollow noopener" target="_blank">승인 정책</a>에 의거, 클라이언트가 접근할 수 있는 정보를 결정하고, 누가 언제 무엇을 접근했는지 감사하고, 사용한 작업량에 따라 요금을 부과하고, 요금을 지불하지 못한 클라이언트의 접근을 거부합니다.</p> <p>Istio의 신원 정보 모델은 최고 수준의 “서비스 신원(<code class="language-plaintext highlighter-rouge">service identity</code>)”을 사용하여 요청자의 신원을 결정합니다. 이 모델은 서비스 신원이 인간 사용자, 개별 워크로드 혹은 워크로드 그룹 등 다양한 대상을 대표할 수 있어, 뛰어난 유연성과 세분성을 제공합니다. 서비스 신원이 부여되지 않은 플랫폼에서는 Istio가 서비스 이름과 같이 일부 워크로드 인스턴스를 대표하는 다른 신원 정보를 사용할 수 있습니다.</p> <p>다음 목록은 다양한 플랫폼에서 사용할 수 있는 서비스 신원의 예를 보여줍니다.</p> <ul> <li>쿠버네티스: 쿠버네티스의 서비스 계정(service account)</li> <li>GCE: GCP 서비스 계정(service account)</li> <li>온프레미스(비 쿠버네티스): user account, custom service account, Istio service account, 혹은 GCP service account. 커스텀 서비스 계정은 고객의 Identity Directory에서 관리하는 신원 정보와 같은 기존 서비스 계정을 의미합니다.</li> </ul> <p><br></p> <h2 id="신원-및-인증서-관리">신원 및 인증서 관리</h2> <p>Istio는 X.509 인증서를 사용하여 모든 워크로드에 강력한 신원 정보를 안전하게 제공합니다. 각 Envoy 프록시와 함께 실행되는 Istio 에이전트는 istiod와 협력하여 대규모로 키 및 인증서를 주기적으로 재생성하고 이를 자동화 합니다. 아래 그림은 신원 정보 생성 흐름을 보여줍니다.</p> <p><img src="https://istio.io/latest/docs/concepts/security/id-prov.svg" alt="Identity Provisioning Workflow"></p> <p>Istio는 아래의 흐름에 따라 키와 인증서를 생성합니다:</p> <ol> <li> <code class="language-plaintext highlighter-rouge">istiod</code>는 인증서 서명 요청(<a href="https://en.wikipedia.org/wiki/Certificate_signing_request" rel="external nofollow noopener" target="_blank">certificate signing requests</a>, CSR)을 받아들이기 위해 gRPC 서비스를 제공합니다.</li> <li>프로세스가 시작되면 Istio 에이전트는 개인 키와 CSR을 생성한 다음 서명을 위해 해당 자격 정보과 함께 CSR을 <code class="language-plaintext highlighter-rouge">istiod</code>로 보냅니다.</li> <li> <code class="language-plaintext highlighter-rouge">istiod</code>의 CA는 CSR에 포함된 자격 정보가 유효한지 확인합니다. 검증이 성공하면 CSR에 서명하여 인증서를 생성합니다.</li> <li>워크로드가 시작되면 Envoy는 Envoy SDS(Secret Discovery Service) API를 통해 같은 컨테이너에 있는 Istio 에이전트의 인증서와 키를 요청합니다.</li> <li>Istio 에이전트는 <code class="language-plaintext highlighter-rouge">istiod</code>로부터 받은 인증서와 개인 키를 Envoy SDS API를 통해 Envoy로 보냅니다.</li> <li>Istio 에이전트는 워크로드별 인증서가 만료되었는지 모니터링하고, 만료되었을 경우 위 프로세스를 반복합니다.</li> </ol> <p><br></p> <h2 id="인증authentication">인증(Authentication)</h2> <p>Istio는 두가지 형태의 인증방법을 제공합니다:</p> <ul> <li>대등 인증: 연결을 시도하는 클라이언트를 확인하기 위해 서비스 간 인증에 사용됩니다. Istio는 전송 인증을 위한 풀스택 솔루션으로 <a href="https://en.wikipedia.org/wiki/Mutual_authentication" rel="external nofollow noopener" target="_blank">mutual TLS</a>를 제공하며, 이는 서비스 코드의 변경 없이 이루어 집니다. 이 솔루션은 다음과 같습니다: <ul> <li>클러스터와 클라우드 간 상호 운용성을 지원하고자 각 서비스에 강력한 신원 정보를 제공</li> <li>서비스간 통신을 보호</li> <li>키 및 인증서 생성, 배포, 순환을 자동화하는 키 관리 시스템 제공</li> </ul> </li> <li>요청 인증: 요청에 첨부된 자격 증명 정보를 확인하고자 최종 사용자 인증에 사용됩니다. Istio는 JSON Web Token(JWT) 검증 방식의 요청별 인증을 지원하며, 맞춤형 인증 공급자 또는 OpenID Connect 공급자를 사용하여 간소화된 개발자 경험을 지원합니다. 인증 공급자의 예는 다음과 같습니다: <ul> <li><a href="https://www.ory.sh/" rel="external nofollow noopener" target="_blank">ORY Hydra</a></li> <li><a href="https://www.keycloak.org/" rel="external nofollow noopener" target="_blank">Keycloak</a></li> <li><a href="https://auth0.com/" rel="external nofollow noopener" target="_blank">AuthO</a></li> <li><a href="https://firebase.google.com/docs/auth/" rel="external nofollow noopener" target="_blank">Firebase Auth</a></li> <li><a href="https://developers.google.com/identity/protocols/OpenIDConnect" rel="external nofollow noopener" target="_blank">Google Auth</a></li> </ul> </li> </ul> <p>어느 인증 공급자를 쓰건 상관없이 Istio는 맞춤형 쿠버네티스 API를 통해 Istio 설정 저장소(<code class="language-plaintext highlighter-rouge">Istio config store</code>)에 인증 정책을 저장합니다. Istio는 각 프록시에 대한 키와 인증 정책을 지속적으로 업데이트 합니다. 또한 Istio는 정책 변경이 시행되기 전 새로 변경된 정책이 보안 상태에 어떤 영향을 미칠 수 있는지 이해하는데 도움이 되도록 허용 모드(permissive mode)에서의 인증을 지원합니다.</p> <p><br></p> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"alshedivat/al-folio","data-repo-id":"MDEwOlJlcG9zaXRvcnk2MDAyNDM2NQ==","data-category":"Comments","data-category-id":"DIC_kwDOA5PmLc4CTBt6","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,a])=>giscusScript.setAttribute(t,a)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Senalyst . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>